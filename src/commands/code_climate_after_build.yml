description: Sum the coverage files and submit to Code Climate.
parameters:
  when:
    type: string
    default: on_success
steps:
  - run:
      command: |
        ./cc-test-reporter format-coverage -t simplecov -o "coverage/codeclimate.$CIRCLE_NODE_INDEX.json"
      when: << parameters.when >>
  - deploy:
      command: |
        ./cc-test-reporter sum-coverage --output - --parts $CIRCLE_NODE_TOTAL coverage/codeclimate.*.json | ./cc-test-reporter upload-coverage --debug --input -
      when: << parameters.when >>
